@model MCR.Theme.ViewComponents.HeroBannerWidgetViewModel

@{
    var heroId = "hero-" + Guid.NewGuid().ToString("N").Substring(0, 8);
    var hasSlides = Model.Slides.Any();
    var slideCount = Model.Slides.Count;

    // Build background style
    var backgroundStyle = "";
    if (!string.IsNullOrEmpty(Model.BackgroundImage))
    {
        backgroundStyle = $"background-image: url('{Model.BackgroundImage}'); background-size: cover; background-position: center;";
    }
    else if (!string.IsNullOrEmpty(Model.BackgroundColor))
    {
        backgroundStyle = $"background: {Model.BackgroundColor};";
    }
}

<section class="hero-banner @(Model.ContactFormWidgetData != null ? "hero-with-form" : "")" id="@heroId" style="@backgroundStyle">
    <div class="hero-overlay"></div>
    <div class="container">
        <div class="hero-content-wrapper">
            @* Left side - Rotating content *@
            <div class="hero-text-content">
                @if (hasSlides)
                {
                    <div class="hero-slider" data-autoplay="@Model.AutoPlay.ToString().ToLower()" data-interval="@Model.SlideInterval">
                        @foreach (var (slide, index) in Model.Slides.Select((s, i) => (s, i)))
                        {
                            <div class="hero-slide @(index == 0 ? "active" : "")" data-index="@index">
                                @if (!string.IsNullOrEmpty(slide.Headline))
                                {
                                    <h1 class="hero-headline">@slide.Headline</h1>
                                }
                                @if (!string.IsNullOrEmpty(slide.Subheadline))
                                {
                                    <p class="hero-subheadline">@slide.Subheadline</p>
                                }
                                <div class="hero-buttons">
                                    @if (!string.IsNullOrEmpty(slide.PrimaryButtonText) && !string.IsNullOrEmpty(slide.PrimaryButtonUrl))
                                    {
                                        <a href="@slide.PrimaryButtonUrl" class="btn btn-cta btn-lg">@slide.PrimaryButtonText</a>
                                    }
                                    @if (!string.IsNullOrEmpty(slide.SecondaryButtonText) && !string.IsNullOrEmpty(slide.SecondaryButtonUrl))
                                    {
                                        <a href="@slide.SecondaryButtonUrl" class="btn btn-outline-light btn-lg">@slide.SecondaryButtonText</a>
                                    }
                                </div>
                            </div>
                        }
                    </div>

                    @if (Model.ShowIndicators && slideCount > 1)
                    {
                        <div class="hero-indicators">
                            @for (var i = 0; i < slideCount; i++)
                            {
                                <button class="hero-indicator @(i == 0 ? "active" : "")" data-slide="@i" aria-label="Go to slide @(i + 1)"></button>
                            }
                        </div>
                    }
                }
            </div>

            @* Right side - Contact Form (uses embedded ContactFormWidget) *@
            @if (Model.ContactFormWidgetData != null)
            {
                <div class="hero-form-wrapper">
                    @await Component.InvokeAsync("ContactFormWidget", new { widgetData = Model.ContactFormWidgetData, cssClass = "hero-contact-form" })
                </div>
            }
        </div>
    </div>
</section>

<script>
(function() {
    const heroSection = document.getElementById('@heroId');
    if (!heroSection) return;

    const slider = heroSection.querySelector('.hero-slider');
    if (!slider) return;

    const slides = slider.querySelectorAll('.hero-slide');
    const indicators = heroSection.querySelectorAll('.hero-indicator');
    const autoplay = slider.dataset.autoplay === 'true';
    const interval = parseInt(slider.dataset.interval) || 5000;

    if (slides.length <= 1) return;

    let currentSlide = 0;
    let slideTimer = null;

    function showSlide(index) {
        slides.forEach((slide, i) => {
            slide.classList.toggle('active', i === index);
        });
        indicators.forEach((indicator, i) => {
            indicator.classList.toggle('active', i === index);
        });
        currentSlide = index;
    }

    function nextSlide() {
        const next = (currentSlide + 1) % slides.length;
        showSlide(next);
    }

    function startAutoplay() {
        if (autoplay && slides.length > 1) {
            slideTimer = setInterval(nextSlide, interval);
        }
    }

    function stopAutoplay() {
        if (slideTimer) {
            clearInterval(slideTimer);
            slideTimer = null;
        }
    }

    // Indicator click handlers
    indicators.forEach((indicator, index) => {
        indicator.addEventListener('click', () => {
            stopAutoplay();
            showSlide(index);
            startAutoplay();
        });
    });

    // Pause on hover
    heroSection.addEventListener('mouseenter', stopAutoplay);
    heroSection.addEventListener('mouseleave', startAutoplay);

    // Start autoplay
    startAutoplay();
})();
</script>
